"use strict";(globalThis.webpackChunktemp_docusaurus=globalThis.webpackChunktemp_docusaurus||[]).push([[7743],{8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>a});var s=o(6540);const i={},t=s.createContext(i);function r(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(t.Provider,{value:n},e.children)}},8553:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"module-1-ros2/nodes-topics","title":"ROS 2 Architecture & Middleware","description":"1. The Robotic Nervous System: A Deep Dive","source":"@site/docs/module-1-ros2/01-nodes-topics.md","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/nodes-topics","permalink":"/Physical-AI-Humanoid-Robotics-Book/docs/module-1-ros2/nodes-topics","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-1-ros2/01-nodes-topics.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"ROS 2 Architecture & Middleware"},"sidebar":"textbookSidebar","next":{"title":"Advanced Agents: The Follow Me Logic","permalink":"/Physical-AI-Humanoid-Robotics-Book/docs/module-1-ros2/python-agents"}}');var i=o(4848),t=o(8453);const r={sidebar_position:1,title:"ROS 2 Architecture & Middleware"},a="ROS 2 Nodes, Topics, and the DDS Middleware",d={},l=[{value:"1. The Robotic Nervous System: A Deep Dive",id:"1-the-robotic-nervous-system-a-deep-dive",level:2},{value:"1.1 Why DDS Matters for Humanoids",id:"11-why-dds-matters-for-humanoids",level:3},{value:"2. Nodes: The Atoms of Computation",id:"2-nodes-the-atoms-of-computation",level:2},{value:"2.1 Lifecycle Nodes (Managed Nodes)",id:"21-lifecycle-nodes-managed-nodes",level:3},{value:"State Machine of a Lifecycle Node",id:"state-machine-of-a-lifecycle-node",level:4},{value:"3. Topics: Asynchronous Communication",id:"3-topics-asynchronous-communication",level:2},{value:"3.1 Topic Statistics &amp; Bandwidth",id:"31-topic-statistics--bandwidth",level:3},{value:"4. Hands-On: A Complex Python Node",id:"4-hands-on-a-complex-python-node",level:2},{value:"<code>joint_monitor.py</code>",id:"joint_monitorpy",level:3},{value:"4.1 Running the Node",id:"41-running-the-node",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"ros-2-nodes-topics-and-the-dds-middleware",children:"ROS 2 Nodes, Topics, and the DDS Middleware"})}),"\n",(0,i.jsx)(n.h2,{id:"1-the-robotic-nervous-system-a-deep-dive",children:"1. The Robotic Nervous System: A Deep Dive"}),"\n",(0,i.jsxs)(n.p,{children:["In the realm of Physical AI, the ",(0,i.jsx)(n.strong,{children:"Robot Operating System 2 (ROS 2)"}),' is not just a library; it is the fundamental middleware that allows a machine to "think" and "act" in parallel. Unlike its predecessor, ROS 1, which relied on a custom TCP/IP master, ROS 2 is built on top of the ',(0,i.jsx)(n.strong,{children:"Data Distribution Service (DDS)"})," standard."]}),"\n",(0,i.jsx)(n.h3,{id:"11-why-dds-matters-for-humanoids",children:"1.1 Why DDS Matters for Humanoids"}),"\n",(0,i.jsx)(n.p,{children:"Humanoid robots require real-time control. If your robot is balancing on one leg, a delay of 10 milliseconds in the motor command loop can cause it to fall. DDS provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Real-time guarantees"}),": Ensuring messages arrive within a deadline."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Quality of Service (QoS)"}),': Fine-tuning how data is sent (e.g., "Best Effort" for video, "Reliable" for motor commands).']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Decentralization"}),': No single point of failure (no "roscore").']}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mermaid",children:'graph TD\n    A[Camera Node] --\x3e|Topic: /image_raw (Best Effort)| B(Vision Processing Node);\n    B --\x3e|Topic: /obstacle_pos (Reliable)| C{Navigation Node};\n    C --\x3e|Topic: /cmd_vel (Reliable)| D[Motor Controller Node];\n    subgraph "DDS Domain (ID: 0)"\n    A\n    B\n    C\n    D\n    end\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-nodes-the-atoms-of-computation",children:"2. Nodes: The Atoms of Computation"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"Node"})," is a single, modular process. In a humanoid, you might have hundreds of nodes running simultaneously:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"face_recognition_node"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"balance_controller_node"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"speech_synthesis_node"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"battery_monitor_node"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"21-lifecycle-nodes-managed-nodes",children:"2.1 Lifecycle Nodes (Managed Nodes)"}),"\n",(0,i.jsxs)(n.p,{children:["For professional robotics, we use ",(0,i.jsx)(n.strong,{children:"Lifecycle Nodes"}),". These nodes have managed states (",(0,i.jsx)(n.code,{children:"Unconfigured"}),", ",(0,i.jsx)(n.code,{children:"Inactive"}),", ",(0,i.jsx)(n.code,{children:"Active"}),", ",(0,i.jsx)(n.code,{children:"Finalized"}),"). This prevents a robot from trying to walk before its sensors are calibrated."]}),"\n",(0,i.jsx)(n.h4,{id:"state-machine-of-a-lifecycle-node",children:"State Machine of a Lifecycle Node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mermaid",children:"stateDiagram-v2\n    [*] --\x3e Unconfigured\n    Unconfigured --\x3e Inactive: Configure()\n    Inactive --\x3e Active: Activate()\n    Active --\x3e Inactive: Deactivate()\n    Inactive --\x3e Unconfigured: Cleanup()\n    Active --\x3e Finalized: Shutdown()\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-topics-asynchronous-communication",children:"3. Topics: Asynchronous Communication"}),"\n",(0,i.jsx)(n.p,{children:'Topics are the "blood vessels" carrying data. They use a Publish/Subscribe model.'}),"\n",(0,i.jsx)(n.h3,{id:"31-topic-statistics--bandwidth",children:"3.1 Topic Statistics & Bandwidth"}),"\n",(0,i.jsx)(n.p,{children:"When running high-bandwidth sensors (like a RealSense D435i depth camera), topics can saturate your network."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Command to check bandwidth:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 topic bw /camera/depth/image_rect_raw\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Subscribers: 1\nPublisher count: 1\nAverage: 24.5 MB/s\nMean: 24.1 MB/s\nMin: 22.0 MB/s\nMax: 26.5 MB/s\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If you see >500 MB/s, you might need to use ",(0,i.jsx)(n.strong,{children:"Zero Copy"})," transport (shared memory) to prevent CPU overload on the Jetson Orin."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-hands-on-a-complex-python-node",children:"4. Hands-On: A Complex Python Node"}),"\n",(0,i.jsxs)(n.p,{children:["Let's write a node that simulates a ",(0,i.jsx)(n.strong,{children:"Temperature Monitor"})," for the robot's joints. It will publish an alarm if the temperature exceeds a threshold."]}),"\n",(0,i.jsx)(n.h3,{id:"joint_monitorpy",children:(0,i.jsx)(n.code,{children:"joint_monitor.py"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float32, String\nimport random\n\nclass JointTemperatureMonitor(Node):\n    def __init__(self):\n        super().__init__('joint_temp_monitor')\n        \n        # Publisher for Alarms (Reliable QoS)\n        self.alarm_pub = self.create_publisher(String, '/robot/status/alarm', 10)\n        \n        # Publisher for Telemetry (Best Effort QoS)\n        self.temp_pub = self.create_publisher(Float32, '/robot/joint/knee_temp', 10)\n        \n        # Timer: Run at 10 Hz (every 0.1 seconds)\n        self.timer = self.create_timer(0.1, self.check_temperature)\n        \n        self.get_logger().info(\"Joint Monitor Started...\")\n\n    def check_temperature(self):\n        # Simulate sensor reading (20C to 90C)\n        current_temp = random.uniform(20.0, 90.0)\n        \n        # Publish Telemetry\n        msg = Float32()\n        msg.data = current_temp\n        self.temp_pub.publish(msg)\n        \n        # Check logic\n        if current_temp > 80.0:\n            alarm = String()\n            alarm.data = f\"CRITICAL: Knee Joint Overheat! ({current_temp:.2f}C)\"\n            self.alarm_pub.publish(alarm)\n            self.get_logger().warn(alarm.data)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = JointTemperatureMonitor()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"41-running-the-node",children:"4.1 Running the Node"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Save the file as ",(0,i.jsx)(n.code,{children:"joint_monitor.py"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Run it: ",(0,i.jsx)(n.code,{children:"python3 joint_monitor.py"})]}),"\n",(0,i.jsxs)(n.li,{children:["In another terminal, listen to the alarm: ",(0,i.jsx)(n.code,{children:"ros2 topic echo /robot/status/alarm"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You will see alarms appearing only when the random temperature exceeds 80\xb0C."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);