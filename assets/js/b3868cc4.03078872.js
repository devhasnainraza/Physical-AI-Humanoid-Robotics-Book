"use strict";(globalThis.webpackChunkcortex_h1=globalThis.webpackChunkcortex_h1||[]).push([[234],{5965:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-1-ros2/kinematics-dynamics","title":"1.3 URDF & TF2","description":"Building the robot model and managing coordinate frames.","source":"@site/docs/module-1-ros2/03-kinematics-dynamics.md","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/kinematics-dynamics","permalink":"/Cortex-H1/docs/module-1-ros2/kinematics-dynamics","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-1-ros2/03-kinematics-dynamics.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"kinematics-dynamics","title":"1.3 URDF & TF2","sidebar_label":"1.3 Kinematics (URDF)","description":"Building the robot model and managing coordinate frames."},"sidebar":"textbookSidebar","previous":{"title":"1.2 Hardware Interface","permalink":"/Cortex-H1/docs/module-1-ros2/robot-hardware"},"next":{"title":"1.4 Control","permalink":"/Cortex-H1/docs/module-1-ros2/control-systems"}}');var a=s(4848),r=s(8453);const t={id:"kinematics-dynamics",title:"1.3 URDF & TF2",sidebar_label:"1.3 Kinematics (URDF)",description:"Building the robot model and managing coordinate frames."},l="1.3 Kinematics in ROS 2: URDF & TF2",o={},c=[{value:"\ud83c\udfaf Lab Objectives",id:"-lab-objectives",level:2},{value:"1.3.1 URDF (Unified Robot Description Format)",id:"131-urdf-unified-robot-description-format",level:2},{value:"Lab: Create <code>my_robot.urdf</code>",id:"lab-create-my_roboturdf",level:3},{value:"1.3.2 Robot State Publisher",id:"132-robot-state-publisher",level:2},{value:"Launching the Visualization",id:"launching-the-visualization",level:3},{value:"1.3.3 TF2: The Time Machine",id:"133-tf2-the-time-machine",level:2},{value:"Python TF Listener Example",id:"python-tf-listener-example",level:3},{value:"1.3.4 Quiz",id:"134-quiz",level:2}];function d(e){const n={annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"13-kinematics-in-ros-2-urdf--tf2",children:"1.3 Kinematics in ROS 2: URDF & TF2"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\"If you don't know where your hand is, you can't pick up the cup.\""})}),"\n",(0,a.jsx)(n.p,{children:"In this lab, we define the robot's physical structure (URDF) and track its moving parts (TF2)."}),"\n",(0,a.jsx)(n.h2,{id:"-lab-objectives",children:"\ud83c\udfaf Lab Objectives"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Write a URDF"})," for a 2-joint arm."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Visualize it"})," in RViz."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Broadcast TFs"})," using ",(0,a.jsx)(n.code,{children:"robot_state_publisher"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"131-urdf-unified-robot-description-format",children:"1.3.1 URDF (Unified Robot Description Format)"}),"\n",(0,a.jsx)(n.p,{children:"URDF is an XML file that describes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Links"}),": The rigid parts (bones)."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Joints"}),": The moving parts (hinges)."]}),"\n"]}),"\n",(0,a.jsxs)(n.h3,{id:"lab-create-my_roboturdf",children:["Lab: Create ",(0,a.jsx)(n.code,{children:"my_robot.urdf"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<robot name="simple_arm">\n\n  \x3c!-- Base Link --\x3e\n  <link name="base_link">\n    <visual>\n      <geometry>\n        <box size="0.2 0.2 0.1"/>\n      </geometry>\n      <material name="blue">\n        <color rgba="0 0 1 1"/>\n      </material>\n    </visual>\n  </link>\n\n  \x3c!-- Arm Link --\x3e\n  <link name="arm_link">\n    <visual>\n      <geometry>\n        <cylinder length="0.5" radius="0.05"/>\n      </geometry>\n      <origin xyz="0 0 0.25" rpy="0 0 0"/>\n      <material name="red">\n        <color rgba="1 0 0 1"/>\n      </material>\n    </visual>\n  </link>\n\n  \x3c!-- Joint connecting Base and Arm --\x3e\n  <joint name="base_to_arm" type="revolute">\n    <parent link="base_link"/>\n    <child link="arm_link"/>\n    <origin xyz="0 0 0.05"/>\n    <axis xyz="0 1 0"/> \x3c!-- Rotates around Y --\x3e\n    <limit lower="-1.57" upper="1.57" effort="10" velocity="1"/>\n  </joint>\n\n</robot>\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"132-robot-state-publisher",children:"1.3.2 Robot State Publisher"}),"\n",(0,a.jsxs)(n.p,{children:["How does ROS know where ",(0,a.jsx)(n.code,{children:"arm_link"})," is relative to ",(0,a.jsx)(n.code,{children:"base_link"}),"?"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"It reads the URDF."}),"\n",(0,a.jsxs)(n.li,{children:["It subscribes to ",(0,a.jsx)(n.code,{children:"/joint_states"})," (Current angle of the joint)."]}),"\n",(0,a.jsx)(n.li,{children:"It performs Forward Kinematics."}),"\n",(0,a.jsxs)(n.li,{children:["It broadcasts the result to ",(0,a.jsx)(n.code,{children:"/tf"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"launching-the-visualization",children:"Launching the Visualization"}),"\n",(0,a.jsxs)(n.p,{children:["Create a launch file ",(0,a.jsx)(n.code,{children:"display.launch.py"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from launch import LaunchDescription\nfrom launch_ros.actions import Node\nimport xacro\n\ndef generate_launch_description():\n    urdf_file = 'my_robot.urdf'\n    with open(urdf_file, 'r') as infp:\n        robot_desc = infp.read()\n\n    return LaunchDescription([\n        Node(\n            package='robot_state_publisher',\n            executable='robot_state_publisher',\n            parameters=[{'robot_description': robot_desc}],\n        ),\n        Node(\n            package='joint_state_publisher_gui',\n            executable='joint_state_publisher_gui',\n        ),\n        Node(\n            package='rviz2',\n            executable='rviz2',\n        ),\n    ])\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Run it"}),": You will see a GUI slider. Move it, and the red arm rotates in 3D!"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"133-tf2-the-time-machine",children:"1.3.3 TF2: The Time Machine"}),"\n",(0,a.jsx)(n.p,{children:"TF2 is a library that tracks coordinate frames over time."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Buffer"}),": Stores the last 10 seconds of transforms."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Query"}),': "Where was the camera frame relative to the hand frame 2 seconds ago?"']}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:'Why "Time"?'}),"\nSensor data is old by the time you get it."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Camera sees a cup at ",(0,a.jsxs)(n.span,{className:"katex",children:[(0,a.jsx)(n.span,{className:"katex-mathml",children:(0,a.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(n.semantics,{children:[(0,a.jsxs)(n.mrow,{children:[(0,a.jsx)(n.mi,{children:"t"}),(0,a.jsx)(n.mo,{children:"="}),(0,a.jsx)(n.mn,{children:"100"}),(0,a.jsx)(n.mi,{children:"m"}),(0,a.jsx)(n.mi,{children:"s"})]}),(0,a.jsx)(n.annotation,{encoding:"application/x-tex",children:"t=100ms"})]})})}),(0,a.jsxs)(n.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.6151em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(n.span,{className:"mrel",children:"="}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.6444em"}}),(0,a.jsx)(n.span,{className:"mord",children:"100"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"m"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"s"})]})]})]}),"."]}),"\n",(0,a.jsx)(n.li,{children:"Robot moves."}),"\n",(0,a.jsxs)(n.li,{children:["At ",(0,a.jsxs)(n.span,{className:"katex",children:[(0,a.jsx)(n.span,{className:"katex-mathml",children:(0,a.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(n.semantics,{children:[(0,a.jsxs)(n.mrow,{children:[(0,a.jsx)(n.mi,{children:"t"}),(0,a.jsx)(n.mo,{children:"="}),(0,a.jsx)(n.mn,{children:"150"}),(0,a.jsx)(n.mi,{children:"m"}),(0,a.jsx)(n.mi,{children:"s"})]}),(0,a.jsx)(n.annotation,{encoding:"application/x-tex",children:"t=150ms"})]})})}),(0,a.jsxs)(n.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.6151em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(n.span,{className:"mrel",children:"="}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.6444em"}}),(0,a.jsx)(n.span,{className:"mord",children:"150"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"m"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"s"})]})]})]}),", you try to grab it."]}),"\n",(0,a.jsxs)(n.li,{children:["TF2 calculates exactly where the cup was at ",(0,a.jsxs)(n.span,{className:"katex",children:[(0,a.jsx)(n.span,{className:"katex-mathml",children:(0,a.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(n.semantics,{children:[(0,a.jsxs)(n.mrow,{children:[(0,a.jsx)(n.mi,{children:"t"}),(0,a.jsx)(n.mo,{children:"="}),(0,a.jsx)(n.mn,{children:"100"}),(0,a.jsx)(n.mi,{children:"m"}),(0,a.jsx)(n.mi,{children:"s"})]}),(0,a.jsx)(n.annotation,{encoding:"application/x-tex",children:"t=100ms"})]})})}),(0,a.jsxs)(n.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.6151em"}}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(n.span,{className:"mrel",children:"="}),(0,a.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(n.span,{className:"base",children:[(0,a.jsx)(n.span,{className:"strut",style:{height:"0.6444em"}}),(0,a.jsx)(n.span,{className:"mord",children:"100"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"m"}),(0,a.jsx)(n.span,{className:"mord mathnormal",children:"s"})]})]})]})," and transforms it to where the hand is ",(0,a.jsx)(n.em,{children:"now"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"python-tf-listener-example",children:"Python TF Listener Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from tf2_ros import TransformListener, Buffer\n\n# In your node\nself.tf_buffer = Buffer()\nself.tf_listener = TransformListener(self.tf_buffer, self)\n\n# Look up transform\ntry:\n    t = self.tf_buffer.lookup_transform(\n        'base_link',\n        'camera_link',\n        rclpy.time.Time()) # Get latest\n    self.get_logger().info(f'Trans: {t.transform.translation}')\nexcept Exception as e:\n    self.get_logger().info(f'Could not find transform: {e}')\n"})}),"\n",(0,a.jsx)(n.h2,{id:"134-quiz",children:"1.3.4 Quiz"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["What publishes to ",(0,a.jsx)(n.code,{children:"/tf"}),"?"]})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["a) ",(0,a.jsx)(n.code,{children:"robot_state_publisher"}),"."]}),"\n",(0,a.jsx)(n.li,{children:"b) The motor."}),"\n",(0,a.jsx)(n.li,{children:"c) The camera."}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.em,{children:"Answer: a (mostly)"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["Why do we need a ",(0,a.jsx)(n.code,{children:"joint_state_publisher"}),"?"]})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"a) To tell ROS the current angles of the joints so FK can be computed."}),"\n",(0,a.jsx)(n.li,{children:"b) To drive the robot."}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.em,{children:"Answer: a"})}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var i=s(6540);const a={},r=i.createContext(a);function t(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);