"use strict";(globalThis.webpackChunkcortex_h1=globalThis.webpackChunkcortex_h1||[]).push([[8168],{8453:(e,s,t)=>{t.d(s,{R:()=>r,x:()=>i});var n=t(6540);const l={},a=n.createContext(l);function r(e){const s=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),n.createElement(a.Provider,{value:s},e.children)}},9444:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"labs/lab-3-pid-controller","title":"Lab 3: Implementing a PID Controller for a Simulated Robot Joint","description":"Objective","source":"@site/docs/labs/lab-3-pid-controller.md","sourceDirName":"labs","slug":"/labs/lab-3-pid-controller","permalink":"/Cortex-H1/docs/labs/lab-3-pid-controller","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/labs/lab-3-pid-controller.md","tags":[],"version":"current","frontMatter":{"id":"lab-3-pid-controller","title":"Lab 3: Implementing a PID Controller for a Simulated Robot Joint","sidebar_label":"Lab 3: PID Controller"},"sidebar":"textbookSidebar","previous":{"title":"Lab 2: URDF Modeling","permalink":"/Cortex-H1/docs/labs/lab-2-urdf-modeling"},"next":{"title":"Lab 4: Visual SLAM","permalink":"/Cortex-H1/docs/labs/lab-4-visual-slam"}}');var l=t(4848),a=t(8453);const r={id:"lab-3-pid-controller",title:"Lab 3: Implementing a PID Controller for a Simulated Robot Joint",sidebar_label:"Lab 3: PID Controller"},i="Lab 3: Implementing a PID Controller for a Simulated Robot Joint",o={},c=[{value:"Objective",id:"objective",level:2},{value:"Theoretical Background",id:"theoretical-background",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step-by-Step Instructions",id:"step-by-step-instructions",level:2},{value:"Step 1: Create a New ROS 2 Package for Control",id:"step-1-create-a-new-ros-2-package-for-control",level:3},{value:"Step 2: Implement the PID Controller Class",id:"step-2-implement-the-pid-controller-class",level:3},{value:"Step 3: Simulate a Joint with ROS 2",id:"step-3-simulate-a-joint-with-ros-2",level:3},{value:"Step 4: Update <code>setup.py</code> and <code>package.xml</code>",id:"step-4-update-setuppy-and-packagexml",level:3},{value:"Step 5: Build Your Package",id:"step-5-build-your-package",level:3},{value:"Step 6: Source and Run the Controller",id:"step-6-source-and-run-the-controller",level:3},{value:"Step 7: Visualize with <code>rqt_plot</code> (Optional but Recommended)",id:"step-7-visualize-with-rqt_plot-optional-but-recommended",level:3},{value:"Verification",id:"verification",level:2},{value:"Challenge Questions",id:"challenge-questions",level:2}];function d(e){const s={annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",math:"math",mi:"mi",mo:"mo",mrow:"mrow",msub:"msub",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"lab-3-implementing-a-pid-controller-for-a-simulated-robot-joint",children:"Lab 3: Implementing a PID Controller for a Simulated Robot Joint"})}),"\n",(0,l.jsx)(s.h2,{id:"objective",children:"Objective"}),"\n",(0,l.jsxs)(s.p,{children:["This lab provides a hands-on application of PID control theory (Chapter 4). You will implement a custom PID controller in Python and simulate its effect on a robot joint, observing how different gain values (",(0,l.jsxs)(s.span,{className:"katex",children:[(0,l.jsx)(s.span,{className:"katex-mathml",children:(0,l.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(s.semantics,{children:[(0,l.jsxs)(s.mrow,{children:[(0,l.jsxs)(s.msub,{children:[(0,l.jsx)(s.mi,{children:"K"}),(0,l.jsx)(s.mi,{children:"p"})]}),(0,l.jsx)(s.mo,{separator:"true",children:","}),(0,l.jsxs)(s.msub,{children:[(0,l.jsx)(s.mi,{children:"K"}),(0,l.jsx)(s.mi,{children:"i"})]}),(0,l.jsx)(s.mo,{separator:"true",children:","}),(0,l.jsxs)(s.msub,{children:[(0,l.jsx)(s.mi,{children:"K"}),(0,l.jsx)(s.mi,{children:"d"})]})]}),(0,l.jsx)(s.annotation,{encoding:"application/x-tex",children:"K_p, K_i, K_d"})]})})}),(0,l.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(s.span,{className:"base",children:[(0,l.jsx)(s.span,{className:"strut",style:{height:"0.9694em",verticalAlign:"-0.2861em"}}),(0,l.jsxs)(s.span,{className:"mord",children:[(0,l.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,l.jsx)(s.span,{className:"msupsub",children:(0,l.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(s.span,{className:"vlist-r",children:[(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.1514em"},children:(0,l.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,l.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(s.span,{className:"mord mathnormal mtight",children:"p"})})]})}),(0,l.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(s.span,{className:"vlist-r",children:(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.2861em"},children:(0,l.jsx)(s.span,{})})})]})})]}),(0,l.jsx)(s.span,{className:"mpunct",children:","}),(0,l.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,l.jsxs)(s.span,{className:"mord",children:[(0,l.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,l.jsx)(s.span,{className:"msupsub",children:(0,l.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(s.span,{className:"vlist-r",children:[(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.3117em"},children:(0,l.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,l.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(s.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,l.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(s.span,{className:"vlist-r",children:(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,l.jsx)(s.span,{})})})]})})]}),(0,l.jsx)(s.span,{className:"mpunct",children:","}),(0,l.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,l.jsxs)(s.span,{className:"mord",children:[(0,l.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,l.jsx)(s.span,{className:"msupsub",children:(0,l.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(s.span,{className:"vlist-r",children:[(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.3361em"},children:(0,l.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,l.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(s.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,l.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(s.span,{className:"vlist-r",children:(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,l.jsx)(s.span,{})})})]})})]})]})})]}),") affect the joint's movement towards a desired setpoint."]}),"\n",(0,l.jsx)(s.h2,{id:"theoretical-background",children:"Theoretical Background"}),"\n",(0,l.jsxs)(s.p,{children:["A ",(0,l.jsx)(s.strong,{children:"PID (Proportional-Integral-Derivative) controller"})," is a feedback control loop mechanism widely used in industrial control systems and robotics. It continuously calculates an ",(0,l.jsx)(s.code,{children:"error"})," value as the difference between a desired ",(0,l.jsx)(s.code,{children:"setpoint"})," and a measured ",(0,l.jsx)(s.code,{children:"process variable"}),". The controller attempts to minimize the error by adjusting the ",(0,l.jsx)(s.code,{children:"control output"}),"."]}),"\n",(0,l.jsx)(s.p,{children:"The three terms refer to:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsxs)(s.strong,{children:["Proportional (",(0,l.jsxs)(s.span,{className:"katex",children:[(0,l.jsx)(s.span,{className:"katex-mathml",children:(0,l.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(s.semantics,{children:[(0,l.jsx)(s.mrow,{children:(0,l.jsxs)(s.msub,{children:[(0,l.jsx)(s.mi,{children:"K"}),(0,l.jsx)(s.mi,{children:"p"})]})}),(0,l.jsx)(s.annotation,{encoding:"application/x-tex",children:"K_p"})]})})}),(0,l.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(s.span,{className:"base",children:[(0,l.jsx)(s.span,{className:"strut",style:{height:"0.9694em",verticalAlign:"-0.2861em"}}),(0,l.jsxs)(s.span,{className:"mord",children:[(0,l.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,l.jsx)(s.span,{className:"msupsub",children:(0,l.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(s.span,{className:"vlist-r",children:[(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.1514em"},children:(0,l.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,l.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(s.span,{className:"mord mathnormal mtight",children:"p"})})]})}),(0,l.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(s.span,{className:"vlist-r",children:(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.2861em"},children:(0,l.jsx)(s.span,{})})})]})})]})]})})]}),")"]}),": Accounts for present values of the error."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsxs)(s.strong,{children:["Integral (",(0,l.jsxs)(s.span,{className:"katex",children:[(0,l.jsx)(s.span,{className:"katex-mathml",children:(0,l.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(s.semantics,{children:[(0,l.jsx)(s.mrow,{children:(0,l.jsxs)(s.msub,{children:[(0,l.jsx)(s.mi,{children:"K"}),(0,l.jsx)(s.mi,{children:"i"})]})}),(0,l.jsx)(s.annotation,{encoding:"application/x-tex",children:"K_i"})]})})}),(0,l.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(s.span,{className:"base",children:[(0,l.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,l.jsxs)(s.span,{className:"mord",children:[(0,l.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,l.jsx)(s.span,{className:"msupsub",children:(0,l.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(s.span,{className:"vlist-r",children:[(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.3117em"},children:(0,l.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,l.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(s.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,l.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(s.span,{className:"vlist-r",children:(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,l.jsx)(s.span,{})})})]})})]})]})})]}),")"]}),": Accounts for past values of the error."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsxs)(s.strong,{children:["Derivative (",(0,l.jsxs)(s.span,{className:"katex",children:[(0,l.jsx)(s.span,{className:"katex-mathml",children:(0,l.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(s.semantics,{children:[(0,l.jsx)(s.mrow,{children:(0,l.jsxs)(s.msub,{children:[(0,l.jsx)(s.mi,{children:"K"}),(0,l.jsx)(s.mi,{children:"d"})]})}),(0,l.jsx)(s.annotation,{encoding:"application/x-tex",children:"K_d"})]})})}),(0,l.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(s.span,{className:"base",children:[(0,l.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,l.jsxs)(s.span,{className:"mord",children:[(0,l.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,l.jsx)(s.span,{className:"msupsub",children:(0,l.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(s.span,{className:"vlist-r",children:[(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.3361em"},children:(0,l.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,l.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(s.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,l.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(s.span,{className:"vlist-r",children:(0,l.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,l.jsx)(s.span,{})})})]})})]})]})})]}),")"]}),": Accounts for possible future values of the error."]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"The output from the PID controller is the weighted sum of these three terms."}),"\n",(0,l.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"ROS 2 Humble Development Environment"}),": Set up as in Lab 1."]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Python 3.10+"}),": With ",(0,l.jsx)(s.code,{children:"numpy"}),"."]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"step-by-step-instructions",children:"Step-by-Step Instructions"}),"\n",(0,l.jsx)(s.h3,{id:"step-1-create-a-new-ros-2-package-for-control",children:"Step 1: Create a New ROS 2 Package for Control"}),"\n",(0,l.jsx)(s.p,{children:"We'll create a Python package for our controller."}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python my_robot_control\n"})}),"\n",(0,l.jsx)(s.h3,{id:"step-2-implement-the-pid-controller-class",children:"Step 2: Implement the PID Controller Class"}),"\n",(0,l.jsxs)(s.p,{children:["Navigate into your new package's directory (",(0,l.jsx)(s.code,{children:"~/ros2_ws/src/my_robot_control"}),").\nCreate a file named ",(0,l.jsx)(s.code,{children:"my_robot_control/pid_controller.py"})," and add the PID class we discussed in Chapter 4:"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:'import time\nimport numpy as np\n\nclass PIDController:\n    """\n    A robust PID controller implementation for robotics applications.\n    Includes anti-windup and derivative kick prevention.\n    """\n    def __init__(self, Kp, Ki, Kd, setpoint, output_limits=(-10.0, 10.0), windup_guard=20.0, sample_time=0.1):\n        self.Kp = Kp\n        self.Ki = Ki\n        self.Kd = Kd\n        self.setpoint = setpoint\n        self.output_limits = output_limits\n        self.windup_guard = windup_guard\n        self.sample_time = sample_time # Expected time between updates\n        \n        self.clear()\n\n    def clear(self):\n        """Resets the controller\'s state variables."""\n        self.last_time = None\n        self.last_error = 0.0\n        self.integral = 0.0\n        self.previous_measurement = 0.0 # Used for derivative on measurement\n\n    def update(self, measurement):\n        """\n        Calculates the control signal based on the current measurement.\n        """\n        current_time = time.time()\n        if self.last_time is None:\n            self.last_time = current_time\n            self.previous_measurement = measurement\n            return 0.0 # No control action on first update\n\n        dt = current_time - self.last_time\n        \n        # If dt is too small, skip update to prevent derivative noise amplification\n        if dt < self.sample_time / 2.0: # Only update if sufficient time has passed\n            return self.last_output # Return last computed output\n\n        error = self.setpoint - measurement\n        \n        # Proportional term\n        p_term = self.Kp * error\n        \n        # Integral term with anti-windup guard\n        self.integral += error * dt\n        self.integral = np.clip(self.integral, -self.windup_guard, self.windup_guard)\n        i_term = self.Ki * self.integral\n        \n        # Derivative term: calculated on measurement to avoid derivative kick\n        derivative = (measurement - self.previous_measurement) / dt\n        d_term = self.Kd * -derivative # Negative sign for feedback\n\n        # Calculate the raw output\n        output = p_term + i_term + d_term\n        \n        # Clamp the output to defined limits\n        output = np.clip(output, self.output_limits[0], self.output_limits[1])\n        \n        # Store state for next iteration\n        self.last_error = error # For P and I\n        self.previous_measurement = measurement # For D\n        self.last_time = current_time\n        self.last_output = output # Store last output for dt filtering\n        \n        return output\n\n'})}),"\n",(0,l.jsx)(s.h3,{id:"step-3-simulate-a-joint-with-ros-2",children:"Step 3: Simulate a Joint with ROS 2"}),"\n",(0,l.jsxs)(s.p,{children:["We'll create a ROS 2 node that simulates a joint and applies the PID controller.\nCreate a file named ",(0,l.jsx)(s.code,{children:"my_robot_control/joint_controller_node.py"})," and add the following code:"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64\nfrom my_robot_control.pid_controller import PIDController # Import our PID class\n\nclass JointControllerNode(Node):\n\n    def __init__(self):\n        super().__init__('joint_controller_node')\n        \n        # Declare parameters for PID gains and setpoint\n        self.declare_parameter('setpoint', 0.0)\n        self.declare_parameter('kp', 0.8)\n        self.declare_parameter('ki', 0.05)\n        self.declare_parameter('kd', 0.1)\n        self.declare_parameter('output_min', -5.0)\n        self.declare_parameter('output_max', 5.0)\n        self.declare_parameter('windup_guard', 10.0)\n        self.declare_parameter('sample_time', 0.01) # 100 Hz simulation\n\n        # Get parameters\n        setpoint = self.get_parameter('setpoint').get_parameter_value().double_value\n        kp = self.get_parameter('kp').get_parameter_value().double_value\n        ki = self.get_parameter('ki').get_parameter_value().double_value\n        kd = self.get_parameter('kd').get_parameter_value().double_value\n        output_min = self.get_parameter('output_min').get_parameter_value().double_value\n        output_max = self.get_parameter('output_max').get_parameter_value().double_value\n        windup_guard = self.get_parameter('windup_guard').get_parameter_value().double_value\n        sample_time = self.get_parameter('sample_time').get_parameter_value().double_value\n\n        self.get_logger().info(f\"PID Controller for setpoint: {setpoint}, Kp:{kp}, Ki:{ki}, Kd:{kd}\")\n\n        # Initialize PID controller\n        self.pid = PIDController(\n            Kp=kp, Ki=ki, Kd=kd, setpoint=setpoint, \n            output_limits=(output_min, output_max), \n            windup_guard=windup_guard, \n            sample_time=sample_time\n        )\n\n        # Simulate a joint state\n        self.current_joint_position = 0.0 # Starts at 0 degrees/radians\n        self.joint_velocity = 0.0\n        self.joint_acceleration = 0.0\n        \n        # Publishers\n        self.position_pub = self.create_publisher(Float64, '/sim_joint/position', 10)\n        self.control_pub = self.create_publisher(Float64, '/sim_joint/control_output', 10)\n\n        # Timer to run the simulation loop\n        self.timer = self.create_timer(sample_time, self.update_joint_state)\n\n    def update_joint_state(self):\n        # 1. Get current measurement\n        measurement = self.current_joint_position\n\n        # 2. Update PID and get control output\n        control_output = self.pid.update(measurement)\n\n        # 3. Simulate joint physics (very simple model: control_output acts like a force)\n        # a = F/m, v = v + a*dt, p = p + v*dt\n        mass = 1.0 # kg\n        damping = 0.1 # friction\n        \n        force = control_output - (self.joint_velocity * damping) # Apply damping\n        acceleration = force / mass\n        \n        self.joint_velocity += acceleration * self.pid.sample_time\n        self.current_joint_position += self.joint_velocity * self.pid.sample_time\n\n        # Publish current state and control output\n        pos_msg = Float64()\n        pos_msg.data = self.current_joint_position\n        self.position_pub.publish(pos_msg)\n\n        ctrl_msg = Float64()\n        ctrl_msg.data = control_output\n        self.control_pub.publish(ctrl_msg)\n        \n        self.get_logger().info(\n            f\"SetP:{self.pid.setpoint:.2f} | Current Pos:{self.current_joint_position:.2f} | Vel:{self.joint_velocity:.2f} | Ctrl:{control_output:.2f}\"\n        )\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = JointControllerNode()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,l.jsxs)(s.h3,{id:"step-4-update-setuppy-and-packagexml",children:["Step 4: Update ",(0,l.jsx)(s.code,{children:"setup.py"})," and ",(0,l.jsx)(s.code,{children:"package.xml"})]}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsxs)(s.strong,{children:["Update ",(0,l.jsx)(s.code,{children:"~/ros2_ws/src/my_robot_control/setup.py"})]}),":\nAdd the ",(0,l.jsx)(s.code,{children:"entry_points"})," for the new node."]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'joint_controller = my_robot_control.joint_controller_node:main',\n    ],\n},\n"})}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsxs)(s.strong,{children:["Update ",(0,l.jsx)(s.code,{children:"~/ros2_ws/src/my_robot_control/package.xml"})]}),":\nAdd ",(0,l.jsx)(s.code,{children:"std_msgs"})," dependency if not already present."]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-xml",children:"  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n  <depend>numpy</depend>\n"})}),"\n",(0,l.jsx)(s.h3,{id:"step-5-build-your-package",children:"Step 5: Build Your Package"}),"\n",(0,l.jsx)(s.p,{children:"Navigate back to your workspace root and build your package:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select my_robot_control\n"})}),"\n",(0,l.jsx)(s.h3,{id:"step-6-source-and-run-the-controller",children:"Step 6: Source and Run the Controller"}),"\n",(0,l.jsx)(s.p,{children:"Source your workspace:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:". install/setup.bash\n"})}),"\n",(0,l.jsx)(s.p,{children:"Now, run your joint controller. We'll set the setpoint to 45 degrees (or radians, depending on your interpretation) and tune the gains."}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"ros2 run my_robot_control joint_controller --ros-args -p setpoint:=45.0 -p kp:=0.8 -p ki:=0.05 -p kd:=0.1\n"})}),"\n",(0,l.jsxs)(s.p,{children:["Observe the output in the terminal. The ",(0,l.jsx)(s.code,{children:"Current Pos"})," should smoothly approach ",(0,l.jsx)(s.code,{children:"45.0"}),"."]}),"\n",(0,l.jsxs)(s.h3,{id:"step-7-visualize-with-rqt_plot-optional-but-recommended",children:["Step 7: Visualize with ",(0,l.jsx)(s.code,{children:"rqt_plot"})," (Optional but Recommended)"]}),"\n",(0,l.jsx)(s.p,{children:"Open a new terminal, source your workspace, and run:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"rqt_plot /sim_joint/position /sim_joint/control_output\n"})}),"\n",(0,l.jsxs)(s.p,{children:["You will see a real-time plot of the joint's position and the control output from the PID controller. Experiment with different ",(0,l.jsx)(s.code,{children:"kp"}),", ",(0,l.jsx)(s.code,{children:"ki"}),", ",(0,l.jsx)(s.code,{children:"kd"})," values to see how they affect the plot (e.g., higher Kp leads to faster response but more overshoot)."]}),"\n",(0,l.jsx)(s.h2,{id:"verification",children:"Verification"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["The joint's ",(0,l.jsx)(s.code,{children:"Current Pos"})," should converge to the ",(0,l.jsx)(s.code,{children:"setpoint"})," in the terminal output."]}),"\n",(0,l.jsxs)(s.li,{children:["The ",(0,l.jsx)(s.code,{children:"rqt_plot"})," should show a smooth curve for position approaching the setpoint, and the control output should settle near zero once the setpoint is reached."]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"challenge-questions",children:"Challenge Questions"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Tuning"}),": Experiment with different ",(0,l.jsx)(s.code,{children:"Kp"}),", ",(0,l.jsx)(s.code,{children:"Ki"}),", ",(0,l.jsx)(s.code,{children:"Kd"})," values. Can you make the joint reach the setpoint faster without significant overshoot? What happens if ",(0,l.jsx)(s.code,{children:"Kp"})," is too high?"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Integral Windup"}),": Set a very high ",(0,l.jsx)(s.code,{children:"Ki"})," and a ",(0,l.jsx)(s.code,{children:"setpoint"})," that is initially unreachable (e.g., ",(0,l.jsx)(s.code,{children:"setpoint:=1000"}),"). Observe the ",(0,l.jsx)(s.code,{children:"control_output"}),". Once the setpoint becomes reachable, what happens? How does the ",(0,l.jsx)(s.code,{children:"windup_guard"})," help?"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Disturbance"}),": Modify the ",(0,l.jsx)(s.code,{children:"update_joint_state"})," to add a small, constant ",(0,l.jsx)(s.code,{children:"disturbance"})," force. How does the PID controller compensate?"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Reference Tracking"}),": Change the ",(0,l.jsx)(s.code,{children:"setpoint"})," dynamically during runtime (e.g., using a ROS 2 parameter update or a subscription to a new topic). How does the controller track the changing reference?"]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);