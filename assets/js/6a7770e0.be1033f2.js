"use strict";(globalThis.webpackChunkcortex_h1=globalThis.webpackChunkcortex_h1||[]).push([[460],{8237:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"module-7-hri/safety-standards","title":"7.3 Lab: Safety & E-Stop","description":"Implementing a software E-Stop and Speed Limiter.","source":"@site/docs/module-7-hri/03-safety-standards.md","sourceDirName":"module-7-hri","slug":"/module-7-hri/safety-standards","permalink":"/Cortex-H1/docs/module-7-hri/safety-standards","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-7-hri/03-safety-standards.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"safety-standards","title":"7.3 Lab: Safety & E-Stop","sidebar_label":"7.3 Lab: Safety","description":"Implementing a software E-Stop and Speed Limiter."},"sidebar":"textbookSidebar","previous":{"title":"7.2 Lab: Social Nav","permalink":"/Cortex-H1/docs/module-7-hri/social-navigation"},"next":{"title":"Lab 1: ROS 2 Dev Env","permalink":"/Cortex-H1/docs/labs/lab-1-ros2-dev-env"}}');var i=s(4848),r=s(8453);const l={id:"safety-standards",title:"7.3 Lab: Safety & E-Stop",sidebar_label:"7.3 Lab: Safety",description:"Implementing a software E-Stop and Speed Limiter."},o="7.3 Lab: Safety & E-Stop",a={},d=[{value:"\ud83c\udfaf Lab Objectives",id:"-lab-objectives",level:2},{value:"7.3.1 The Architecture: Twist Mux",id:"731-the-architecture-twist-mux",level:2},{value:"7.3.2 The Safety Node",id:"732-the-safety-node",level:2},{value:"7.3.3 Configuring Twist Mux",id:"733-configuring-twist-mux",level:2},{value:"7.3.4 Quiz",id:"734-quiz",level:2}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"73-lab-safety--e-stop",children:"7.3 Lab: Safety & E-Stop"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:'"Stop."'})}),"\n",(0,i.jsx)(n.p,{children:"Safety is not a feature; it is a requirement."}),"\n",(0,i.jsx)(n.h2,{id:"-lab-objectives",children:"\ud83c\udfaf Lab Objectives"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Write a Safety Node"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement Speed Scaling"})," based on proximity."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Override ",(0,i.jsx)(n.code,{children:"/cmd_vel"})]})," (Multiplexer)."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"731-the-architecture-twist-mux",children:"7.3.1 The Architecture: Twist Mux"}),"\n",(0,i.jsxs)(n.p,{children:["We don't want 10 nodes fighting for ",(0,i.jsx)(n.code,{children:"/cmd_vel"}),".\nWe use ",(0,i.jsx)(n.code,{children:"twist_mux"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Priority 100"}),": Safety Stop (0, 0)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Priority 50"}),": Teleop."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Priority 10"}),": Nav2."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"732-the-safety-node",children:"7.3.2 The Safety Node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class SafetyNode(Node):\n    def __init__(self):\n        super().__init__('safety_monitor')\n        self.scan_sub = self.create_subscription(LaserScan, '/scan', self.scan_cb, 10)\n        self.stop_pub = self.create_publisher(Twist, '/safety/cmd_vel', 10)\n        \n    def scan_cb(self, msg):\n        min_dist = min(msg.ranges)\n        \n        if min_dist < 0.3: # 30cm\n            # E-STOP!\n            stop_msg = Twist() # Zeros\n            self.stop_pub.publish(stop_msg)\n            self.get_logger().error(\"EMERGENCY STOP!\")\n"})}),"\n",(0,i.jsx)(n.h2,{id:"733-configuring-twist-mux",children:"7.3.3 Configuring Twist Mux"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"topics:\n  - name: safety\n    topic: safety/cmd_vel\n    timeout: 0.5\n    priority: 100\n  - name: nav\n    topic: cmd_vel\n    timeout: 0.5\n    priority: 10\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now, if ",(0,i.jsx)(n.code,{children:"SafetyNode"})," publishes zeros, ",(0,i.jsx)(n.code,{children:"twist_mux"})," will ignore Nav2 and send Zeros to the wheels."]}),"\n",(0,i.jsx)(n.h2,{id:"734-quiz",children:"7.3.4 Quiz"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Why do we use a Multiplexer (Mux)?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"a) To allow higher-priority signals (Safety) to override lower-priority ones (Nav) cleanly."}),"\n",(0,i.jsx)(n.li,{children:"b) To mix signals."}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.em,{children:"Answer: a"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:'What is a "Dead Man\'s Switch"?'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"a) A switch you must hold to keep the robot moving. If you let go (or die), it stops."}),"\n",(0,i.jsx)(n.li,{children:"b) A switch for zombies."}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.em,{children:"Answer: a"})}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var t=s(6540);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);