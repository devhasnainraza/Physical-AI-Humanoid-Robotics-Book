"use strict";(globalThis.webpackChunktemp_docusaurus=globalThis.webpackChunktemp_docusaurus||[]).push([[1594],{5222:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"module-1-ros2/python-agents","title":"Advanced Agents: The Follow Me Logic","description":"1. From Reflex to Control Theory","source":"@site/docs/module-1-ros2/02-python-agents.md","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/python-agents","permalink":"/Physical-AI-Humanoid-Robotics-Book/docs/module-1-ros2/python-agents","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-1-ros2/02-python-agents.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Advanced Agents: The Follow Me Logic"},"sidebar":"textbookSidebar","previous":{"title":"Lab: Creating a URDF for a Humanoid Robot","permalink":"/Physical-AI-Humanoid-Robotics-Book/docs/module-1-ros2/lab-urdf"},"next":{"title":"Modeling Robots with URDF","permalink":"/Physical-AI-Humanoid-Robotics-Book/docs/module-1-ros2/urdf-modeling"}}');var t=n(4848),s=n(8453);const i={sidebar_position:2,title:"Advanced Agents: The Follow Me Logic"},l='Building a "Follow Me" Agent with PID Control',a={},d=[{value:"1. From Reflex to Control Theory",id:"1-from-reflex-to-control-theory",level:2},{value:"1.1 The Control Loop",id:"11-the-control-loop",level:3},{value:"2. Implementation: The <code>FollowerAgent</code>",id:"2-implementation-the-followeragent",level:2},{value:"<code>follower_agent.py</code>",id:"follower_agentpy",level:3},{value:"3. Integration with Hardware Profiles",id:"3-integration-with-hardware-profiles",level:2},{value:"Unitree Go2 Specifics",id:"unitree-go2-specifics",level:3},{value:"Jetson + Kobuki Base",id:"jetson--kobuki-base",level:3}];function c(e){const o={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{HardwareOnly:n}=o;return n||function(e,o){throw new Error("Expected "+(o?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("HardwareOnly",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.header,{children:(0,t.jsx)(o.h1,{id:"building-a-follow-me-agent-with-pid-control",children:'Building a "Follow Me" Agent with PID Control'})}),"\n",(0,t.jsx)(o.h2,{id:"1-from-reflex-to-control-theory",children:"1. From Reflex to Control Theory"}),"\n",(0,t.jsxs)(o.p,{children:['A simple "reflex" agent (if X, then Y) is often too jerky for a physical robot. If a person takes one step back, a reflex robot might lurch forward instantly. To make movement smooth and human-like, we use ',(0,t.jsx)(o.strong,{children:"PID Controllers"})," (Proportional-Integral-Derivative)."]}),"\n",(0,t.jsx)(o.h3,{id:"11-the-control-loop",children:"1.1 The Control Loop"}),"\n",(0,t.jsxs)(o.p,{children:["We want to maintain a specific ",(0,t.jsx)(o.strong,{children:"Target Distance"})," (e.g., 1.0 meter) from the human."]}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Error"})," = (Current Distance) - (Target Distance)"]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Proportional (P)"}),": Move fast if error is large, slow if error is small."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Derivative (D)"}),': "Dampen" the movement to prevent overshooting (stopping too late).']}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Integral (I)"}),": Fix small, long-term errors (like getting stuck 1.01m away)."]}),"\n"]}),"\n",(0,t.jsx)(o.hr,{}),"\n",(0,t.jsxs)(o.h2,{id:"2-implementation-the-followeragent",children:["2. Implementation: The ",(0,t.jsx)(o.code,{children:"FollowerAgent"})]}),"\n",(0,t.jsx)(o.p,{children:'This agent subscribes to a hypothetical "Person Detector" topic (which might come from a YOLO model) and outputs velocity commands to the robot\'s wheels/legs.'}),"\n",(0,t.jsx)(o.h3,{id:"follower_agentpy",children:(0,t.jsx)(o.code,{children:"follower_agent.py"})}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom std_msgs.msg import Float32\n\nclass FollowerAgent(Node):\n    def __init__(self):\n        super().__init__('follower_agent')\n        \n        # Sub: Distance to person (from Depth Camera/YOLO)\n        self.sub_dist = self.create_subscription(\n            Float32, \n            '/vision/person_distance', \n            self.control_loop, \n            10\n        )\n        \n        # Pub: Velocity command\n        self.pub_vel = self.create_publisher(Twist, '/cmd_vel', 10)\n        \n        # Parameters\n        self.target_dist = 1.0  # meters\n        self.kp = 0.5           # Proportional gain\n        self.kd = 0.1           # Derivative gain\n        \n        # State\n        self.prev_error = 0.0\n        \n        self.get_logger().info(\"Follower Agent Armed via PID\")\n\n    def control_loop(self, msg):\n        current_dist = msg.data\n        \n        # 1. Calculate Error\n        error = current_dist - self.target_dist\n        \n        # 2. Deadzone (Ignore small errors to prevent jitter)\n        if abs(error) < 0.1:\n            cmd = Twist() # Stop\n            self.pub_vel.publish(cmd)\n            return\n\n        # 3. PID Calculation (PD only for simplicity)\n        p_term = self.kp * error\n        d_term = self.kd * (error - self.prev_error)\n        \n        control_signal = p_term + d_term\n        \n        # 4. Safety Cap (Max speed 1.0 m/s)\n        control_signal = max(min(control_signal, 1.0), -1.0)\n        \n        # 5. Publish Command\n        cmd = Twist()\n        cmd.linear.x = control_signal # Move forward/backward\n        cmd.angular.z = 0.0           # Assume person is centered for now\n        \n        self.pub_vel.publish(cmd)\n        \n        # Update state\n        self.prev_error = error\n        self.get_logger().info(f\"Dist: {current_dist:.2f}m | Error: {error:.2f} | Cmd: {control_signal:.2f}\")\n\ndef main(args=None):\n    rclpy.init(args=args)\n    agent = FollowerAgent()\n    rclpy.spin(agent)\n    agent.destroy_node()\n    rclpy.shutdown()\n"})}),"\n",(0,t.jsx)(o.hr,{}),"\n",(0,t.jsx)(o.h2,{id:"3-integration-with-hardware-profiles",children:"3. Integration with Hardware Profiles"}),"\n",(0,t.jsxs)(n,{profile:"Unitree_Go2",children:[(0,t.jsx)(o.h3,{id:"unitree-go2-specifics",children:"Unitree Go2 Specifics"}),(0,t.jsxs)(o.p,{children:["The Go2 robot does not use standard ",(0,t.jsx)(o.code,{children:"/cmd_vel"})," for all modes. To use this agent with the Go2, you must be in ",(0,t.jsx)(o.strong,{children:"Sport Mode"})," or use the high-level API wrapper."]}),(0,t.jsxs)(o.p,{children:[(0,t.jsx)(o.strong,{children:"Remapping"}),":\nIf you are using the ",(0,t.jsx)(o.code,{children:"unitree_ros2"})," wrapper, you might need to remap the topic:"]}),(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"ros2 run my_package follower_agent --ros-args -r /cmd_vel:=/sport/request\n"})}),(0,t.jsx)(o.p,{children:(0,t.jsxs)(o.em,{children:["(Note: Actual Unitree topic names vary by firmware version; check your ",(0,t.jsx)(o.code,{children:"ros2 topic list"}),")"]})})]}),"\n",(0,t.jsxs)(n,{profile:"Jetson_Orin_Kit",children:[(0,t.jsx)(o.h3,{id:"jetson--kobuki-base",children:"Jetson + Kobuki Base"}),(0,t.jsxs)(o.p,{children:['If you are using the "Proxy Robot" (Jetson on a wheeled base), ',(0,t.jsx)(o.code,{children:"/cmd_vel"})," is standard. However, ensure your PID gains (",(0,t.jsx)(o.code,{children:"kp"}),", ",(0,t.jsx)(o.code,{children:"kd"}),") are tuned lower, as wheeled bases have less friction than legged robots and can drift easily."]})]})]})}function h(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,o,n)=>{n.d(o,{R:()=>i,x:()=>l});var r=n(6540);const t={},s=r.createContext(t);function i(e){const o=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function l(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(s.Provider,{value:o},e.children)}}}]);